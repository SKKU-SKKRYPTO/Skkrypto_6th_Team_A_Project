{"ast":null,"code":"const getIterator = require('get-iterator');\n\nconst toIterable = require('pull-stream-to-async-iterator');\n\nfunction toPull(source) {\n  source = getIterator(source);\n  return async (end, cb) => {\n    if (end) {\n      if (source.return) {\n        try {\n          await source.return();\n        } catch (err) {\n          return cb(err);\n        }\n      }\n\n      return cb(end);\n    }\n\n    let next;\n\n    try {\n      next = await source.next();\n    } catch (err) {\n      return cb(err);\n    }\n\n    if (next.done) return cb(true); // eslint-disable-line\n\n    cb(null, next.value);\n  };\n}\n\ntoPull.source = toPull;\n\ntoPull.transform = toPull.through = source => read => toPull(source(toIterable(read)));\n\ntoPull.duplex = duplex => ({\n  sink: toPull.sink(duplex.sink),\n  source: toPull(duplex.source)\n});\n\ntoPull.sink = sink => {\n  return read => {\n    sink({\n      [Symbol.asyncIterator]() {\n        return this;\n      },\n\n      next: () => new Promise((resolve, reject) => {\n        read(null, (end, value) => {\n          if (end === true) return resolve({\n            done: true,\n            value\n          });\n          if (end) return reject(end);\n          resolve({\n            done: false,\n            value\n          });\n        });\n      }),\n      return: () => new Promise((resolve, reject) => {\n        read(true, (end, value) => {\n          if (end && end !== true) return reject(end);\n          resolve({\n            done: true,\n            value\n          });\n        });\n      }),\n      throw: err => new Promise((resolve, reject) => {\n        read(err, (end, value) => {\n          if (end && end !== true) return reject(end);\n          resolve({\n            done: true,\n            value\n          });\n        });\n      })\n    });\n  };\n};\n\nmodule.exports = toPull;","map":null,"metadata":{},"sourceType":"script"}